{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/metyatech/agent-runner/schema/agent-runner.schema.json",
  "title": "Agent Runner Configuration",
  "type": "object",
  "required": ["owner", "workdirRoot", "pollIntervalSeconds", "concurrency", "labels", "codex"],
  "properties": {
    "owner": {
      "type": "string",
      "minLength": 1
    },
    "repos": {
      "oneOf": [
        { "type": "string", "enum": ["all"] },
        {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1
        }
      ]
    },
    "workdirRoot": {
      "type": "string",
      "minLength": 1
    },
    "pollIntervalSeconds": {
      "type": "integer",
      "minimum": 10,
      "maximum": 3600
    },
    "concurrency": {
      "type": "integer",
      "minimum": 1,
      "maximum": 16
    },
    "idle": {
      "type": "object",
      "required": ["enabled", "maxRunsPerCycle", "cooldownMinutes", "tasks", "promptTemplate"],
      "properties": {
        "enabled": { "type": "boolean" },
        "maxRunsPerCycle": { "type": "integer", "minimum": 1, "maximum": 16 },
        "cooldownMinutes": { "type": "integer", "minimum": 0, "maximum": 10080 },
        "tasks": {
          "type": "array",
          "items": { "type": "string", "minLength": 1 },
          "minItems": 1
        },
        "promptTemplate": { "type": "string", "minLength": 1 },
        "repoScope": { "type": "string", "enum": ["all", "local"] },
        "usageGate": {
          "type": "object",
          "required": [
            "enabled",
            "command",
            "args",
            "timeoutSeconds",
            "minRemainingPercent",
            "weeklySchedule"
          ],
          "properties": {
            "enabled": { "type": "boolean" },
            "command": { "type": "string", "minLength": 1 },
            "args": {
              "type": "array",
              "items": { "type": "string" }
            },
            "timeoutSeconds": { "type": "integer", "minimum": 1, "maximum": 120 },
            "minRemainingPercent": {
              "type": "object",
              "required": ["fiveHour"],
              "properties": {
                "fiveHour": { "type": "number", "minimum": 0, "maximum": 100 }
              },
              "additionalProperties": false
            },
            "weeklySchedule": {
              "type": "object",
              "required": [
                "startMinutes",
                "minRemainingPercentAtStart",
                "minRemainingPercentAtEnd"
              ],
              "properties": {
                "startMinutes": { "type": "integer", "minimum": 0, "maximum": 10080 },
                "minRemainingPercentAtStart": { "type": "number", "minimum": 0, "maximum": 100 },
                "minRemainingPercentAtEnd": { "type": "number", "minimum": 0, "maximum": 100 }
              },
              "additionalProperties": false
            }
          },
          "additionalProperties": false
        }
      },
      "additionalProperties": false
    },
    "labels": {
      "type": "object",
      "required": ["request", "queued", "running", "done", "failed", "needsUser"],
      "properties": {
        "request": { "type": "string", "minLength": 1 },
        "queued": { "type": "string", "minLength": 1 },
        "running": { "type": "string", "minLength": 1 },
        "done": { "type": "string", "minLength": 1 },
        "failed": { "type": "string", "minLength": 1 },
        "needsUser": { "type": "string", "minLength": 1 }
      },
      "additionalProperties": false
    },
    "codex": {
      "type": "object",
      "required": ["command", "args", "promptTemplate"],
      "properties": {
        "command": { "type": "string", "minLength": 1 },
        "args": {
          "type": "array",
          "items": { "type": "string" }
        },
        "promptTemplate": { "type": "string", "minLength": 1 }
      },
      "additionalProperties": false
    }
  },
  "additionalProperties": false
}
